<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geo Circle KML Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
        }
        .container {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #f9f9f9;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            color: #fff;
            background-color: #007BFF;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Geo Circle KML Generator</h1>
        <form id="kmlForm">
            <div class="form-group">
                <label for="businessName">Business Name:</label>
                <input type="text" id="businessName" required>
            </div>
            <div class="form-group">
                <label for="coordinates">Business Coordinates (Latitude, Longitude):</label>
                <input type="text" id="coordinates" placeholder="e.g., 26.250787,82.944086" required>
            </div>
            <div class="form-group">
                <label for="description">Business Description:</label>
                <textarea id="description" rows="3" required></textarea>
            </div>
            <div class="form-group">
                <label>Keywords:</label>
                <input type="text" class="keyword" placeholder="Keyword 1" required>
                <input type="text" class="keyword" placeholder="Keyword 2" required>
                <input type="text" class="keyword" placeholder="Keyword 3" required>
                <input type="text" class="keyword" placeholder="Keyword 4" required>
                <input type="text" class="keyword" placeholder="Keyword 5" required>
            </div>
            <div class="form-group">
                <label for="circleOption">Select Circle Option:</label>
                <select id="circleOption" required>
                    <option value="1">5 Km → 1 Circle</option>
                    <option value="2">10 Km → 2 Circles</option>
                    <option value="3">15 Km → 3 Circles</option>
                    <option value="5">30 Km → 5 Circles</option>
                </select>
            </div>
            <button type="button" id="generateKml">Generate KML</button>
        </form>
    </div>

    <script>
        document.getElementById('generateKml').addEventListener('click', () => {
            const businessName = document.getElementById('businessName').value.trim();
            const coordinates = document.getElementById('coordinates').value.trim();
            const description = document.getElementById('description').value.trim();
            const keywords = Array.from(document.querySelectorAll('.keyword')).map(input => input.value.trim());
            const circleOption = parseInt(document.getElementById('circleOption').value, 10);

            if (!businessName || !coordinates || !description || keywords.some(k => !k)) {
                alert('Please fill out all fields.');
                return;
            }

            const [latitude, longitude] = coordinates.split(',').map(coord => parseFloat(coord.trim()));
            if (isNaN(latitude) || isNaN(longitude)) {
                alert('Invalid coordinates format. Use Latitude, Longitude.');
                return;
            }

            const radii = Array.from({ length: circleOption }, (_, i) => (i + 1) * 5); // Radii in kilometers
            const earthRadius = 6371; // Earth's radius in km

            function calculateCirclePoints(lat, lng, radius) {
                const points = [];
                for (let angle = 0; angle < 360; angle++) {
                    const bearing = angle * (Math.PI / 180); // Degrees to radians
                    const latPoint = Math.asin(
                        Math.sin(lat) * Math.cos(radius / earthRadius) +
                        Math.cos(lat) * Math.sin(radius / earthRadius) * Math.cos(bearing)
                    );
                    const lngPoint = lng + Math.atan2(
                        Math.sin(bearing) * Math.sin(radius / earthRadius) * Math.cos(lat),
                        Math.cos(radius / earthRadius) - Math.sin(lat) * Math.sin(latPoint)
                    );
                    points.push({ lat: latPoint * (180 / Math.PI), lng: lngPoint * (180 / Math.PI) });
                }
                return points;
            }

            function generateKML() {
                let kml = `<?xml version="1.0" encoding="UTF-8"?>\n`;
                kml += `<kml xmlns="http://www.opengis.net/kml/2.2">\n<Document>\n`;
                kml += `<name>${businessName}</name>\n`;

                radii.forEach((radius, radiusIndex) => {
                    const points = calculateCirclePoints(latitude * (Math.PI / 180), longitude * (Math.PI / 180), radius);
                    points.forEach((point, index) => {
                        const keyword = keywords[index % keywords.length];
                        const color = radiusIndex % 2 === 0 ? "ff0000ff" : "ff00ff00"; // Alternate between blue and green

                        kml += `<Placemark>\n`;
                        kml += `<name>${keyword}</name>\n`;
                        kml += `<description>${description}</description>\n`;
                        kml += `<Style><IconStyle><color>${color}</color></IconStyle></Style>\n`;
                        kml += `<Point><coordinates>${point.lng},${point.lat}</coordinates></Point>\n`;
                        kml += `</Placemark>\n`;
                    });
                });

                kml += `</Document>\n</kml>`;
                return kml;
            }

            function downloadKML(content, filename) {
                const blob = new Blob([content], { type: 'application/vnd.google-earth.kml+xml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }

            const kmlContent = generateKML();
            downloadKML(kmlContent, `${businessName.replace(/\s+/g, '_')}_circles.kml`);
        });
    </script>
</body>
</html>
